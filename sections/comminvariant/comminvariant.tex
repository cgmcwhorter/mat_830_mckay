% !TEX root = ../../mat830_mckay.tex
\newpage
\section{Commutative Algebra of Invariant Rings}
\subsection{Noether's Theorem}

There are two standard approaches to this topic: a graded ring approach and a local ring approach. We shall take the former. Let $k$ be a field and $W$ a $d$-dimensional $k$-vector space. Furthermore, let $G \subseteq \GL_n(W) \cong \GL_n(k)$ be a finite group with $|G| \in k^\times$. Define $S=k[W] \cong k[x_1,\ldots,x_d]$ and let $R= S^G$ be its invariant ring. In particular, $R \subseteq S$ is a subalgebra. Now invariant rings are `nicer' than a typical randomly chosen subring of a polynomial ring, by which we mean that there is a `nice' operator on the invariant subring, namely the Reynold's operator $\rho: S \to R$ given by
		\[
		\rho(s)= \dfrac{1}{|G|} \sum_{g \in S} g_S.
		\]
The Reynold's operator is an $R$-linear split surjection, so $S \cong R \oplus \ker \rho$ as $R$-modules. Furthermore, when working with the ring of invariants, one works with symmetric polynomials, which are inherently `nicer' than typical functions. The goal of this section will be to prove the following theorem of Noether:


% \noether28
\begin{restatable}[Noether, 1928]{thm}{noether28} \label{thm:noether28}
The ring $R$ is a noetherian integrally closed domain of Krull dimension $d= \dim_k W$. 
\end{restatable}


\begin{rem}
None of these properties of Noether's Theorem hold for arbitrary subrings of polynomial rings. 
\end{rem}


Recall that the Krull dimension of a $k$-algebra $A$ is the maximal number of algebraically independent elements over $k$. This definition is equivalent to the transcendence degree of the quotient field $Q(A)$ over $k$. If $A$ is the $\C$-algebra given by the coordinate ring of a collection of polynomials, xthen the Krull dimension is the topological dimension of the vanishing set corresponding to $A$; that is, if $A= k[y_1,\ldots,y_m]/(f_1,\ldots,f_r)$, then $\dim A= \dim V(f_1,\ldots,f_r) \subseteq \C^m$. We first show that a polynomial ring is an integral extension of its invariants ring.
 
 
 \begin{lem}
 Let $S=[k_1,\ldots,x_d]$ and $R=S^G$ its ring of invariants. The extension $R \hookrightarrow S$ is integral, i.e. every element of $S$ is a root of a monic polynomial with coefficients in $R$. 
 \end{lem}

\pf For $s \in S$, define $f_s(t):= \prod_{g \in G} (t-gs)$. Then $f_s(t)$ is monic in $t$ and has $s$ as a root since $t-s$ is a factor of $f_s(t)$. The action of $G$ permutes the factors of $f_s(t)$, so it fixes the coefficients of $f_s(t)$. Therefore, $f_s(t) \in R[x]$. \qed \\


This already shows that $\dim R= \dim S= d$ since integral extensions satisfy Going-Up and Going-Down, and thus preserve dimension. We know also that if $A \hookrightarrow B$ is an integral extension of rings and $B$ is finitely generated as an $A$-algebra, then $B$ is finitely generated as an $A$-module (see Atiyah-MacDonald~\cite[Ch.~5]{atiyahmac}). It then follows that


\begin{cor}
Let $S=[k_1,\ldots,x_d]$ and $R=S^G$ its ring of invariants. Then $S$ is a finitely generated $R$-module of rank $|G|$.
\end{cor}

\pf It is enough to show that $S$ is a finitely generated $R$-algebra. Now $S$ is generated over $k$ by $x_1,\ldots,x_d$, so that it is generated over $R$ by $x_1, \ldots, x_d$ as well so that $S$ is a finitely generated $R$-module. It remains to show that $S$ has rank $|G|$. Recall that the rank of a module $M$ over a domain $A$ is $\dim_{Q(A)} M \otimes_A Q(A)$. So we need to compute $\dim_{Q(R)}(S \otimes_R Q(R))$.  But $S \otimes_R Q(R)$ is just $Q(S)$ by integrality. Then any $s \in S$ satisfies an equation $s^p + r_1s^{p-1}+\cdots+r_{p-1}s+r_p=0$, where $r_i \in R$ and $r_p \neq 0$. Then $s(s^{p-1}+r_1s^{p-2}+\cdots+r_{p-1})= -r_p$. Then
	\[
	\dfrac{1}{s}= -\dfrac{1}{r_p} \left( r_1 s^{p-2} + \cdots + r_{p-1} \right).
	\]
If you invert everything in $R$, then you have effectively inverted everything in $s$ by the above. So we need $\dim_{Q(R)} Q(S)$. This a Galois field extension, $Q(S)^G= Q(R)$ so it has degree $|G|$. \qed \\


We now prove that $R$ is noetherian: \\

We know that $S$ is integral over $R$, so that each $x_i$ is integral over $R$. Let $f_1(t), \ldots, f_d(t)$ be monic polynomials with $f_i(x_i)=0$. Let $B \subseteq R$ be the $k$-subalgebra generated by all the coefficients of $f_1,\ldots,f_d$. Then $B$ is finitely generated as a $k$-algebra so that it is noetherian by the Hilbert Basis Theorem. $S$ is integral over $B$, and finitely generated as a $B$-algebra, so finitely generated as a $B$-module. Now $B$ is noetherian and $S$ is a finitely generated $B$-module, every $B$-submodule of $S$ is a finitely generated module. In particular, $R$ must be a finitely generated $B$-module and hence is a noetherian module. Ideals in $R$ are $B$-submodules of $R$ and hence satisfy the ascending chain condition. Hence, $R$ is noetherian. \qed \\



We now prove that $R$ is integrally closed in its quotient field (normal): \\


We know that $Q(S)^= Q(R)$. 


% Field diagram
% 		     Q(S)
%                /        \
% 		S	     \
% 		  \          Q(R)
% 	                R/		


If $x=a/b \in Q(R)$ is integral over $R$, then in particular $x \in Q(S)$ and is integral over $S$. Polynomial rings are integrally closed in their quotient field. So $x \in S$. Hence, $x \in S \cap Q(R)= S \cap Q(S)^G= S^G= R$. When is $R$ a UFD? Always? Never? In between? We know that $S \cong k[x_1,\ldots,x_d]$ is a UFD but $k[u,v]^{C_2}= k[u^2,uv,v^2] \cong k[a,b,c]/(ac-b^2)$ is not a UFD since $u^2 \cdot v^2= (uv)^2$. If we assume that $G$ has no nontrivial linear characters, i.e. no group homomorphisms $G \to k^\times$, then the invariant ring is a UFD. 

\pf Let $r \in R$, then $r \in S$, so we can factor $r= q_1^{a_1} \cdots q_m^{a_n}$, where each $q_i$ is irreducible in $S$ are pairwise non-associate. The $q_i$'s are not necessarily permuted by $G$, but the ideals $(q_1),\ldots,(q_m) \subseteq S$ are. Let $O_1,\ldots,O_e$ be the orbits of the ideals $(q_1),\ldots,(q_m)$ under this action and set
	\[
	Q_j = \prod_{(q_i) \in O_j} q_i^{a_i}
	\]
for $j=1,\ldots,e$. The ideal $(Q_j)$ is stable under the action of $G$, so in particular for any $g \in G$, $gQ_j \in (Q_j)$ so $gQ_j$ is a multiple of $Q_j$. For degree reasons, $gQ_j= \lambda_g Q_j$ for some $\lambda_g \in k^\times$. The function $\lambda: G \to k^\times$ given by $g \mapsto \lambda_g$ (we get one such function for each orbit) and it is a group homomorphism. By assumption, $\lambda$ must be trivial, i.e. $gQ_j= Q_j$ for every $g \in G$ and $j=1,\ldots,e$. Then $Q_j \in R$ for every $j$ and $r= Q_1Q_2 \cdots Q_e$ is a factorization in $R$. Each $Q_j$ is irreducible because it is a product over a single orbit. It is routine, although tedious, to check uniqueness. \qed \\


\begin{ex}
$R= S^G$ is a UFD in the following cases (this is not a complete list, just examples): if $G$ is a nonabelian simple group, e.g. $A_n$ for $n \geq 5$ note that $A_5$ is the $\cI \cong A_5$ group, then we see that the $E_8$ singularity defined by $x^2+y^3+z^5=0$ is a UFD. Or $G= [G,G]$, i.e. every element is a commutator or a product of commutators (in $k^\times$ they are forced to be abelian so go to 1), such groups are called perfect. OR $k= \Q$ and $G$ has odd order (so then does every element) and every image of every element must then be of odd order, which there are none. One can generalize this to $|k|= p^e$ and $\gcd(|G|,|k^\times|=q-1)$. 
\end{ex}


Having proved Noether's Theorem, our next goal is the Hochster-Eagon Theorem that $R= S^G$, i.e. invariant rings are Cohen-Macaulay. We work with graded rings (recall that $k[x_1,\ldots,x_n]= \bigoplus_p k[x_1,\ldots,x_n]_p$), the $p$th graded piece consisting of homogeneous polynomials of degree $p$ and our group actions preserve degree so $k[x_1,\ldots,x_n]^= \bigoplus_p k[x_1,\ldots,x_n]_p^G$. Let $A= \bigoplus_{i=1}^\infty A_i= A_0 \oplus A_1 \oplus \cdots$ be a graded ring with $A_0= k$ a field. Sometimes [Bruns-Herzog] such rings are called *local since they have a unique homogeneous maximal ideal $\fm= A_1 \oplus A_2 \oplus \cdots$. 


\begin{dfn}[Homogenous System of Parameters]
A homogeneous system of parameters for $A$ is a sequence of elements $a_1,\ldots,a_t$ such that $A$ is a finitely generated module over the (graded subring) $k[a_1,\ldots,a_t]$. 
\end{dfn}







%%%%

\subsection{Cohen-Macaulay Rings \& Modules}

\begin{dfn}[Homogeneous]
Let $A= \bigoplus_{i=0}^\infty A_i$ be an $\N$-graded ring with $A_0=k$ a field. An element $a \in A$ is homogeneous if it lies in a unique $A_i$.
\end{dfn}


\begin{dfn}[Homogeneous System of Parameters]
Let $A= \bigoplus_{i=0}^\infty A_i$ be an $\N$-graded ring with $A_0=k$ a field. A sequence $a_1,\ldots,a_m$ of homogeneous elements is called a homogeneous system of parameters (hsop) if $m = \dim A$ and $A$ is a finitely generated module over the graded subring $k[a_1,\ldots,a_n]$. Equivalently, $A/(a_1,\ldots,a_m)$, where $k= \dim A$, is a finite dimensional $k$-vector space. 
\end{dfn}


\begin{ex} \hfill
\begin{enumerate}[(i)]
\item Consider the polynomial ring $A= k[x^2,xy,y^2]$. We claim $\{x^2,y^2\}$ is a hsop. Consider $B= k[x^2,y^2] \subseteq A$. As a $B$-module, $A$ is generated by $1$ and $xy$. Equivalently, $A \cong k[a,b,c]/(ac-b^2)$, $\{a,c\}$ is a hsop as $A/(a,c) \cong k[a,b,c]/(ac-b^2,a,c) \cong k[b]/(b^2)$. 

\item Consider the ring $A= k[x^2,x^3,y,xy]$. Note that $k[x,y]$ is an integral extension of $A$ since $x$ is a root of $t^2-x^2$. Therefore, $\dim A=2$. Now $\{x^2,y \}$ is a hsop: if $B= k[x^2,y]$, then $A= B1 + Bx^3+Bxy$. 
\end{enumerate}
\end{ex}


\begin{thm}[Noether]
Let $k$ be a field and $A$ be a finitely generated $k$-algebra. Then there exist homogeneous elements $a_1,\ldots,a_d$ which are algebraically independent over $k$ and such that $A$ is a finitely generated module over $k[a_1,\ldots,a_d]$ (which is isomorphic to a polynomial ring). 
\end{thm}

It is worth noting that if $k$ is infinite, then there is a probabilistic algorithm for getting the $a_i$'s. In this case, we could take for the $a_i$'s a `sufficiently general' $k$-linear combination of the generators of $A$. This is Noether's Normalization Lemma. Furthermore, the integer $d$ is uniquely determined; it is the Krull dimension of $A$. In the case that $A$ is an integral domain, $d$ is also the transcendence degree of the field of fractions of $A$ over $k$. 


\begin{dfn}[Cohen-Macaulay (CM)]
If $A= \bigoplus_{i=0}^\infty A_i$ is an $\N$-graded ring with $A_0=k$ a field, then if for some (equivalently, any) hsop $a_1,\ldots,a_d$, $A$ is a free module over the Noether normalization $k[x_1,\ldots,x_d]$, we say that $A$ is Cohen-Macaulay (CM). 
\end{dfn}


\begin{ex} \hfill
\begin{enumerate}[(i)]
\item Let $A:= k[x^2,xy,y^2] \supseteq B:= k[x^2,y^2]$. Observe $A= B1+Bxy$ and $\{1, xy\}$ are $B$-linearly independent. Noting also that $1, xy$ are free generators, i.e. $A$ is free over $B$, we see that $A$ is CM.

\item Let $A:= k[x^2,x^3,y,xy] \supseteq B:= k[x^2,y]$. Observing that $A= B1 + Bx^3+Bxy$ but $y(x^3)-x^2(xy)=0$, we see that $A$ is not CM. 

\item Define $A_1= k[x^4,x^3y,x^2y^2,xy^3,y^4]$ and $A_2= k[x^4,x^3y,xy^3,y^4]$. Only one of these is CM, the other is not. (Which?!)
\end{enumerate}
\end{ex}


\begin{dfn}[Maximal Cohen-Macaulay (MCM)]
Let $A$ be as above and $M$ be a finitely generated $A$-module. We say that $M$ is maximal Cohen-Macaulay (MCM) if for some (equivalently, any) hsop, $M$ is a free module over the Noether normalization. 
\end{dfn}


So $A$ is a CM ring if and only if it is a maximal MCM module over itself. 


\begin{rem}
These are not the typical definitions of CM or MCM. They are equivalent, of course. However, one usually begins by considering the local ring case rather than the graded case. However, we choose this approach for clarity and consistency of approach with the rest of the notes.
\end{rem}


\begin{ex} \hfill
\begin{enumerate}[(i)]
\item Let $A= k[x_1,\ldots,x_d]$ be a polynomial ring and $M$ a finitely generated $A$-module. When is $M$ a maximal Cohen-Macaulay module? We know that $\{x_1,\ldots,x_d\}$ form a hsop. But then $M$ is MCM if and only if it is free over $k[x_1,\ldots,x_d]= A$. Therefore for polynomial rings, the MCM rings are the free modules. 

\item Let $A= k[x^2,xy,y^2]$, and let $I= (x^2,xy)A$ be an ideal of $A$. We claim that $I$ is MCM as an $A$-module. Notice that $I$ is isomorphic to the $A$-submodule of $k[x,y]$ generated by $x$ and $y$. Furthermore, $k[x,y] \cong A \oplus (x,y)A$ as $A$-modules. Notice that $\{x^2,y^2\}$ is a hsop for $k[x,y]$. Since polynomial rings are CM, $k[x,y]$ is a free module $k[x^2,y^2]$-module. Then so too must its summands be free. This shows $(x,y)A$ is a free $k[x^2,y^2]$-module as well. 
\end{enumerate}
\end{ex}


As noted, we have taken a non-standard approach to CM and MCM rings. We shall still need alternative definitions for these concepts in places, so we approach them here.


\begin{dfn}[$M$-Regular]
Let $(A,\fm)$ be a local ring, where $\fm$ is the maximal ideal, and $M$ is a finitely generated $A$-module. A sequence $a_1,\ldots,a_t \in \fm$ is an $M$-regular sequence if
	\begin{itemize}
	\item $a_1$ is a nonzerodivisor on $M$
	\item $a_{i+1}$ is not a zero divisor on $M/(a_1,\ldots,a_i)$ for $i=1,\ldots,t-1$
	\end{itemize}
\end{dfn}


\begin{dfn}[Depth]
Let $(A,\fm)$ be a local ring. The depth of a finitely generated $A$-module $M$ is the length of the longest possible $M$-regular sequence.
\end{dfn}


It is known that the depth $\dep M$ is bounded above by $\dim A$, and $M$ is MCM if and only if equality occurs. 


\begin{thm}[Hochster-Eagon] \label{thm:hocheagon}
Let $G$ be a finite subgroup of $\GL(W)$, and assume $|G| \neq 0$ in $k$. Then the invariant ring $k[W]^G$ is a CM ring. 
\end{thm}

\pf Recall Reynold's operator $\rho: k[W]  \twoheadrightarrow k[W]^G$. Let $f_1,\ldots,f_d$ be a hsop in $k[W]^G$. Let $B= k[f_1,\ldots,f_d]$, $R:= k[W]^G$, and $S:= k[W]$.  Then $B \subseteq R \subseteq S$, and $S$ is a finitely generated $R$-module. But then $S$ is a finitely generated $B$-module. Therefore, $f_1,\ldots,f_d$ form a hsop in $S$. Since polynomial rings are CM, $S$ is a free $B$-module. The Reynold's operator makes $R$ into a direct summand of $S$, as $R$-modules. Hence, the Reynold's operator turns $R$ into a $B$-direct summand of a free $B$-module. Therefore, $R$ is free over $B$, as desired. \qed \\


Note that the assumption on $|G|$ is necessary: if we take $C_4$ act by index permutation on $\F_2[x_1,x_2,x_3,x_4]$, then $\F_2[x_1,\ldots,x_4]^{C_4}$ is not CM. This was shown by Bertin in 1967, see Neusel-Smith. Finally, notice that the proof of Theorem~\ref{thm:hocheagon} holds for any $R$-direct summand of $S$. In other words, writing $S= R \oplus M_1 \oplus \cdots \oplus M_r$ as a direct sum of $R$-modules, then each $M_i$ is a MCM $R$-module. What are the $R$-direct summands of $S$? This is a central question of these notes, which we shall spend most of the remaining text trying to answer. 


Recall that if $\chi: G \to k^\times$ is a linear character, then we have the semi-invariants $k[W]^G_\chi:= \{ f \in k[W] \colon gf= \chi(g)f \; \text{ for all } g \in G\}$. We claim that $k[W]^G_\chi$ is an $R$-direct summand of $k[W]$. Define a `fancy' Reynold's operator $\rho_\chi: k[W] \to k[W]^G_\chi$ by 
	\[
	\rho_\chi(f):= \dfrac{1}{|G|} \sum_{g \in G} \chi(g)^{-1} gf.
	\]
Though it is not immediately obvious, we can show that $\im \rho_\chi \subseteq k[W]^G_\chi$ as follows:
	\[
	\begin{split}
	h \rho_\chi(f)&= \vdots \\
	&= \vdots \\
	&= \text{sum over } h^{-1}g \text{see Reynold's proof} \\
	&= \chi(h) \rho_\chi(f).
	\end{split}
	\]
Furthermore, the map $\rho_\chi$ is $R$-linear and splits the inclusion $k[W]^G_\chi \subseteq k[W]$. In other words, $\rho_\chi$ fixes $k[W]^G_\chi$. This shows that each semi-invariant is an $R$-direct summand of $k[W]$. But that is not all! 



\subsection{Isotypic Components}

Isotypic components are the `jazzy' versions of semi-invariants for higher dimensional representations. Let $\chi: G \to k^\times$ be a linear character and $k[W]^G_\chi$ be its ring of semi-invariants. We know that $G$ acts on the polynomial ring $k[W]$ in a way that preserves degrees. But then $G$ acts on each graded piece $k[W]_t$. By Maschke's Theorem, each $k[W]_t$ decomposes into irreducible representations. Fix an irreducible representation $\rho$, and let $k[W]_\rho^G$ be the direct sum of all appearances of $\rho$ in the decomposition above, each in its appropriate degree. This is the isotypic component of $k[W]$ corresponding to $\rho$. `Obviously', 
	\[
	k[W] \cong \bigoplus_{\rho \text{ irred rep}} k[W]_\rho^G. 
	\]
SO each $k[W]^G_\chi$ is an $R$-module, and by the proof of Theorem~\ref{thm:hocheagon}, this is a MCM $R$-module. Though this technically answers our question, it does not held up gain any deeper understanding. Moreover, are these even all the MCM $R$-modules? If not, how do the other MCM $R$-modules relate to the ones arising in the way above? 


Let $\mcm(R)$ denote the set of all MCM $R$-modules. For any ring $R$ and $A$-module $M$, let $\add_A(M)$ be the set of all direct summands and direct sums of copies of $M$, called the ``additive closure'' of $M$. So far we know that $\add_R(S) \subseteq \mcm(R)$. This begs the question, 
	\[
	\add_R(S) = \mcm(R)?
	\]
If not, can we measure the difference between them? Note that it is a conjecture (the Small CM Conjecture, Hochster) that every complete local ring has a MCM module and has been open since the 1960s. Finally, note that $R \in \add_R(S)$ by use of the Reynold's operator.  


Now let $d= \dim_k W$. In the case that $d=1$, then $\GL(W)= \GL_1(k)= k^\times$, so that $G \subseteq k^\times$, a finite group. But any such group must be cyclic, say then that $G \cong C_n$ is generated by a primitive $n$th root of unity, $\omega$. The action of $\omega$ on $k[W] \cong k[x]$ sends $x$ to $\omega x$. What are the invariants? We know $k[x]^{C_n}= k[x^n]$, which is isomorphic to a polynomial ring. We know that every MCM module over a polynomial ring is free. As a $k[x^n]$-module, $k[x]= \bigoplus_{i=0}^{n-1} k[x^n] x^i$, a free module of rank $n$ with basis $\{1,x,\ldots,x^{n-1}\}$. 


Now let $d=2$. This case includes all finite subgroups of $\SL_2(\C)$. First, we shall need some background on reflexive modules, which are slightly weaker than MCM modules, i.e. there are more reflexive modules than MCM modules. 


\begin{dfn}[Reflexive Module]
Let $A$ be a commutative ring and $M$ be an $A$-module. Define an $A$-module $M^*:= \Hom_A(M,A)$ via $(af)(x)= f(ax)$, where $a \in A$, $x \in M$, and $f: M \to A$ is an $A$-map. 
\end{dfn}


We can then define $M^{**}:=(M^*)^*=\Hom_A(M^*,A)= \Hom_A(\Hom_A(M,A),A)$. However, there is a natural map $\theta_M: M \to M^{**}$ given by $x \mapsto e_x$, where $e_x: \Hom_A(M,A) \to A$ is evaluation at $x$, i.e. $f \mapsto f(x)$. In other words, $\theta_M(x)(f)=f(x)$. We say that $M$ is torsionless if $\theta_M$ is injective. We say that $M$ is reflexive if $\theta_M$ is an isomorphism. In particular, $M^{**} \cong M$. 


\begin{rem}
Torsionless means $\theta_M(x)=0$ is the zero map $M^* \to A$ implies that $x=0$. Equivalently, $f(x)=0$ for all $f: M \to A$ implies that $x=0$. This implies that torsionfree-ness. Recall that $M$ is torsionfree if $x \neq 0$, $a \in A$, a nonzerodivisor implies $ax\neq 0$. If $ax=0$ for some $x \in M$, nonzerodivisor $a$, then $0= f(ax)= af(x)$, for all $f \in M^*$. Since $a$ is a nonzerodivisor, this implies $f(x)=0$ for all $f$. By torsionlessness, we get $x=0$. In fact, the two are equivalent over domains. 
\end{rem}


To discuss reflexivity, we need a bit more about depth. However, we shall only sketch proofs of any of the results here. 


\begin{lem} \label{lem:depth}
Let $(A,\fm)$ be a local ring or a graded ring. Let 
	\[
	0 \ma{} L \ma{} M \ma{} P \ma{} 0
	\]
be a short exact sequence of $A$-modules. Then
	\begin{itemize}
	\item $\dep L \geq \min\{ \dep M, \dep N+1\}$
	\item $\dep M \geq \min\{ \dep L, \dep N\}$
	\item $\dep N = \min\{ \dep M, \dep L-1\}$.
	\end{itemize}
\end{lem}

%\begin{lem}[Depth Lemma]
%\[
%0 \ma{} A \ma{} B \ma{} C \ma{} 0
%\]
%If the above is a short exact sequence of $R$-modules, then
%\begin{enumerate}[(i)]
%\item $\dep_I A \geq \min\{ \dep_I B, \dep_I C+1\}$
%\item $\dep_I B \geq \min\{\dep_I A, \dep_I C\}$
%\item $\dep_I C \geq \min\{\dep_I B,\dep_I A-1\}$
%\end{enumerate}
%\end{lem}
%
%\noindent Proof: The third follows by looking at the exact sequence
%\[
%\cdots \ma{} \Ext_R^{i-1}(R/I,B) \ma{} \Ext_R^{i-1}(R/I,C) \ma{} \Ext_R^i(R/I,A) \ma{} \cdots
%\]
%
%Now if $R$ is noetherian and $M$ is finitely generated, $IM \neq M$, then $x \in I$ is a nonzerodivisor on $M$. We want to show first that $\dep_I(M/xM)=\dep_I M-1$. We use the Depth Lemma:
%\[
%0 \ma{} M \ma{x} M \ma{} M/xM \ma{} 0
%\]
%Then $\dep_I \ov{M} \geq \min\{\dep_I M,\dep_I M-1\}= \dep_I M-1$. For the other inequality, we have a long exact sequence 
%\[
%0=\Ext_R^{t-1}(R/I,M) \ma{} \Ext_R^{t-1}(R/I,M/xM) \ma{} \Ext_R^t(R/I,M) \ma{x} \Ext_R^t(R/I,M)
%\]
%where the last two are nonzero as $t-1 \leq \dep$. Now $x \in I$ kills $\Ext_R^t(R/I,M)$ so that the multiplication by $x$ map is the zero map. Then $0 \to \Ext_R^{t-1}(R/I,M/xM) \to \Ext_R^t(R/I,M) \to 0$ is exact. So they are isomorphic and $\Ext_R^t(R/I,M) \neq 0$ so that $\dep_I M/xM \leq t-1$, as desired. 
%
%Now we show that any two maximal $M$-sequences in $I$ have the same length, namely $\dep_I M$. It is enough to show that any $M$-sequence in $I$ can be extended to one of length $t$. So let $x_1,\cdots,x_k$ be a $M$-sequence in $I$. If $k=0$, we can just find a $M$-sequence of length $t$. On the other hand, if $k>0$, we use our work above. We have $\dep_I(M/(x_1,\cdots,x_k)M)=t-k$ so that we can find a sequence $y_1,\cdots,y_{t-k} \in I$ that is a regular sequence on $M/(x_1,\cdots,x_k)M$. But then $x_1,\cdots,x_k,y_1,\cdots,y_{t-k}$ is a $M$-sequence in $I$ of length $t$. \qed \\




\begin{cor}
If $\dep A \geq 2$, then every $A$-module has depth at least 2.
\end{cor}

\pf Let $M$ be reflexive, and begin a free resolution of the dual $M^*$:
	\[
	A^m \ma{} A^n \ma{} M^* \ma{} 0.
	\]
Now applying $\Hom_A(-,A)$, we obtain the exact sequence
	\[
	0 \ma{} M^{**} \ma{} (A^n)^* \ma{f^*} (A^m)^*.
	\]
Let $C:= \coker f^*$, the Auslander transpose of $M^*$. Then
	\[
	0 \ma{} M \ma{} A^n \ma{f^*} A^m \ma{} C \ma{} 0
	\]
is an exact sequence. By Lemma~\ref{lem:depth}, we must have $\dep M= \dep C+2$ or $\dep M=\dep A$, which are both at least two. \qed \\


This argument can be modified to show that $\dep \Hom_A(M,N) \geq 2$ as long as $\dep N \geq 2$. 


\begin{rem}
This is a special property of `2' since the same does not hold replacing 2s by 3s, 4s, etc.. The proof also shows that any reflexive module over any ring is a kernel of a map homomorphism between free modules, i.e. a second syzygy. 
\end{rem}


\begin{ex}
In the case of CM rings of dimension at least 2, e.g. $A= k[x_1,\ldots,x_n]^G$ with $n \geq 2$, $\dep A \geq 2$. 
\end{ex}

 
 Our next goal will be to show that over normal domains that reflexive modules are precisely second syzygies. 



Serre's Conditions 

\begin{thm}[Serre]
Let $A$ be a noetherian domain. The following are equivalent:
	\begin{enumerate}[(i)]
	\item $A$ is integrally closed in its quotient field, i.e. ``normal''
	\item $A$ satisfies $(R_1)$: $A_p$ is a local domain for all primes of height one. $(S_2)$: $\dep A_p \geq \min\{2, \height p\}$ for all primes $p$. 
	\end{enumerate}
\end{thm}


One can define Serre's condition $(S_k)$ for modules $\dep M_p \geq \min\{k,\dim M_p\}$. An interesting fact is that MCM implies that $(S_k)$ for all $k$. 


\begin{lem} \label{lem:lemhelpful}
Let $f: M \to A$ be a homomorphism of $A$-modules. Assume that $N$ satisfies $(S_1)$ and $M$ satisfies $(S_2)$. Then $f$ is an isomorphism if and only if $f_p: M_p \to N_p$ is an isomorphism for every prime of height at most one. 
\end{lem}


\pf See the notes.


\begin{prop}
Let $A$ be a normal domain and $M$ an $A$-module. Then the following are equivalent:
	\begin{enumerate}[(i)]
	\item $M$ is reflexive
	\item $M$ is a second syzygy
	\item $M$ satisfies $(S_2)$
	\end{enumerate}
\end{prop}


\pf We have already seen that (i) implies (ii). Lemma~\ref{lem:depth} shows (ii) implies (iii). It remains to show that (iii) implies (i). To show that $M$ is reflexive, consider $\theta_M: M \to M^{**}$. Since $M$ satisfies $(S_2)$ and $M^{**}$ is a second syzygy, it also satisfies $(S_2)$. Then $\theta_M$ is an isomorphism if and only if the localization $(\theta_M)_p$ is an isomorphism for all primes $p$ of height at most one. So we localize at a prime $p$ of height one. By Serre's Theorem, $A$ satisfies $(R_1)$ so that $A_p$ is a regular local ring of dimension one. The $A_p$-module $M_p$ has depth one by the $(S_2)$ condition. But then $M_p$ is a MCM module over the regular local ring $A_p$, hence free. Free modules are reflexive so $(\theta_M)_p$ is an isomorphism. \qed \\


The point is that over a (graded) normal domain, MCM modules are reflexive. The converse holds if the ring has dimension at most two. The converse fails in dimension three or more. 


\begin{ex}
Let $A= k[x,y,z]$ and $M$ be the ideal $(x,y)$. We have a short exact srquence
	\[
	0 \ma{} (x,y) \ma{} k[x,y,z] \ma{} \dfrac{k[x,y,z]}{(x,y)} \ma{} 0
	\]
Note that $k[x,y,z]/(x,y) \cong k[z]$, which has depth 1. We know that $k[x,y,z]$ has depth 3. By Lemma~\ref{lem:depth}, we know that $\dep (x,y) \geq \min\{3,1+1\} =2$. We know $1= \dep k[x] \geq \min\{3,\dep(x,y)-1\}$. But then $\dep (x,y)=2$. In particular, $(x,y)$ is a reflexive $A$-module by the Proposition. It is not MCM because it is not free. 
\end{ex}


\begin{ex}
Let $A= k[x,y,z]$ and $M= (x,y)$. We have the short exact sequence
	\[
	0 \ma{} (x,y) \ma{} A \ma{} \dfrac{A}{(x,y)} \ma{} 0.
	\]
We know $A/(x,y) \cong k$, a field, so this has depth 0. We know that $\dep A=2$. Then it must be that $\dep (x,y)=1$. So $(x,y)$ is neither reflexive nor MCM. What is $M^{**}$? Consider the free resolution
	\[
	A \ma{} A \oplus A \ma{} (x,y) \ma{} 0
	\]
with maps $a \mapsto (y,-x)$ and $(a,b) \mapsto ax+by$. Taking duals yields,
	\[
	0 \ma{} (x,y)^* \ma{} (A \oplus A)^* \ma{i^*} A^*
	\]
Now $i^*(e_1)$ (the first coordinate function) is $i^*(e_1)=e_1i=y$ and $i^*(e_2)=e_2i= -x$. Then $i^*$ is the map $(a,b) \mapsto ay-bx$ and further $(x,y)^* \cong \ker i^* \cong A(x,y) \cong A$. But $(x,y)^{**} \cong A^* \cong A$. 

% Rewrite
%	\[
%	0 \ma{} A \ma{(y\;-x)^T} A \oplus A \ma{(x\;y)} A
%	\]
%Dualizing gives
%	\[
%	0 \ma{} (x,y)^* \ma{} A \oplus A \ma{(y\;-x)} A
%	\]
%$\ker [y\;-x]= \ker [x\;y]=A$. 
\end{ex}


\begin{thm}[Herzog, 1978]
Let $S= k[u,v]$, $G \subseteq \GL_2(k)$ a finite group with $|G| \in k^*$. Set $R= \widehat{S^G}$, the completion of the invariant ring. Then every indecomposable MCM $R$-module is a direct summand of $\hat{S}= k\llbracket u,v \rrbracket$.
\end{thm}

\pf We shall assume the Krull-Schmidt property for $R$ and $S$, and leave the details passing between the ring and its completion for the reader. Let $M$ be an indecomposable MCM (reflexive) $R$-module. We want $M$ to be a direct summand of $S$ as an $R$-module. Since $|G| \in k^\times$, we have the Reynold's operator, so $R$ is a direct summand of $S$ as $R$-modules. So we have the split monic $R \hookrightarrow S$. Apply $\Hom_R(M^*,-)$. Then we have $\Hom_R(M^*,R) \to \Hom_R(M^*,S)$ still splits. However, $\Hom_R(M^*,R)=M^{**} \cong M$ as $M$ is reflexive. The $R$-module $\Hom_R(M^*,S)$ is naturally an $S$-module: $(sf)(\lambda):= s(f(\lambda))$ for $s \in S$, $f: M^* \to S$, $\lambda \in M^*$. Furthermore, we have proved that $\Hom$ modules have depth $\geq 2$. So $\Hom_R(M^*,S)$ is an $S$-module of depth 2, hence an MCM $S$-module, hence free. So $M$ is a direct summand over $R$ of a free $S$-module. $M \mid S^n$ for some $n$. But $M$ is indecomposable, and we have Krull-Schmidt, so $M$ must be a direct summand of $S$, i.e. $M \mid S$, which is what we wanted to show. \qed \\


\begin{rem}
We need the `hats' in order to use the Krull-Schmidt uniqueness theorem for direct-sum decompositions. This fails even for $k[u,v]$. Could get away with much less, the Hensalization for example. 
\end{rem}


\begin{cor}
For 2-dimensional rings of invariants $R= S^G$. $\add_R(S)=MCM(R)$.
\end{cor}



\begin{ex}
Let $C_n= \langle \sigma \colon \sigma^n=1 \rangle$ act on $S= k[u,v]$ via $\sigma(x)= \omega_n x$, $\sigma(y)= \omega_n^{-1}y$, i.e. 
	\[
	\sigma = \two{\omega_n}{}{}{\omega_n^{-1}} \in \SL_2(k).
	\]
Then $R= S^G= k[u^n,u^{n-1}v, \ldots, v^n]$ (we worked this out before). Furthermore, we worked out $S \cong_{R-mod} R \oplus I_1 \oplus I_2 \oplus \cdots \oplus I_{n-1}$, where $I_j$ is generated as an $R$-module by monomials of degree $j \mod n$. Explicitly, $I_j= (u^j,u^{j-1}v,\ldots,v^j) R \cong (u^jv^{n-j}, u^{j-1}v^{n-j+1}, \ldots, v^n)$. By Herzog's Theorem, every maximal MCM (or reflexive) can be written $R^{a_0} \oplus I_1^{a_1} \oplus I_2 \oplus \cdots \oplus I_{n-1}^{a_{n-1}}$.
\end{ex}


\begin{dfn}
We say that a (local or graded) ring $A$ has finite CM representation type (fCMt) if it has finitely many indecomposable MCM modules up to isomorphism. 
\end{dfn}


\begin{cor}
$k[u,v]^G$ have fCMt. 
\end{cor}


Note that Herzog's Theorem does not hold in dimension greater than two. 

\begin{ex}
Let $C_2= \{\pm 1\}$ act on $k[x,y,z]$. Then $R= k[x^2,y^2,z^2,xy,xz,yz]$. As $R$-modules, $S$ has rank 2 (by previous work) $S \cong R \oplus I$, where $I$ is all monomials of odd degree, i.e. $(x,y,z)R \cong (x^2,xy,xz)R$. Take a syzygy of $I$: 
	\[
	0 \ma{} N:= \ker \pi \ma{} R^3 \ma{\pi} I \ma{} 0
	\]
FACT: Another theorem of Herzog coming soon. $N$ is indecomposable. [Theorem says it is a syzygy of an indecomposable MCM module. So $N$ is an indecomposable MCM module of rank 2, hence it is not isomorphic to either $R$ or $I$, so does not appear as a summand of $S$ (technically, this requires Krull-Schmidt). 
\end{ex}



\subsection{The Gorenstein and Isolated Singularity Properties}


Goal is to determine when invariant rings have these properties, then use them in Auslander version of the \mc Correspondence. 


\begin{dfn}[Gorenstein]
Let $A= A_0 \oplus A_1 \oplus \cdots \oplus A_s$ be a graded algebra over $A_0=k$, a field. Assume that $A_s=0$ but $A_{>s}=0$. Say that $A$ is Gorenstein (or a Poincar\'e duality algebra) if $A_s \cong k$ is a 1-dimensional vector space and for every $i$, the mapping $A_i \times A_{s-i} \to A_s \cong k$ given by $(a,a') \mapsto aa'$ is a perfect pairing. [Recall a bilinear map $\langle, \rangle: V \times W \to k$ is a perfect pairing if the induced map $V \to W^\vee:= \Hom_k(W,k)$ is an isomorphism of vector spaces, where the induced map is given by  $v \mapsto \langle v, - \rangle: W \to k$.] 
\end{dfn}


In particular, if $A$ is Gorenstein, then $A_i^\vee \cong A_{s-i}$. By the way, this is equivalent to the usual definition that $\soc A= \{a \colon a A_{\geq 1}=0 \}$ is 1-dimensional. Notice $A_s$ is always in $\soc A$, and if $\soc$ were to contain any elements of degree $i \neq s$, say $a$, then the map $A_i \to A_{s-i}^\vee$ given by $v \mapsto \mu_v$, multiplication by $v$, would have $a$ in the kernel so that it would not be an $\cong$. 



Bookkeeping devices: For a graded ring $A= \bigoplus_{i=0}^\infty A_i$ where $A_0=k$, the Hilbert function counts vector space dimensions, $H_A(n) \stackrel{def}{=} \dim_k A_n$. One can do this for modules also, $H_M(n) \stackrel{def}{=} \dim_k M_n$. If now $A= A_0 \oplus \cdots \oplus A_s$ is a finite dimensional Gorenstein ring, then $A_i \cong A_{s-i}^\vee$ so they have the same $k$-dimension, so $H_A(i)= H_A(s-i)$, where $i=0,\ldots,s$. That is, the Hilbert function is symmetric. Caution: symmetric hilbert function does not imply gorenstein. Note also $\sum_i H_A(i)= \dim_k( \oplus A_i)= \dim_k A$. The Hilbert series of $A$ is the generating function for its Hilbert function $h_A(t)= \sum_{n \geq 0} H_A(n) t^n$. Notice that $h_A(t)$ is a polynomial if and only if $A_i=0$ for $i \gg 0$ if and only if $\dim_k A< \infty$. 


\begin{thm}[Hilbert]
For $n \gg 0$, $H_A(n)$ agrees with a polynomial $P_A(n)$ of degree $\dim A+1$, called the Hilbert polynomial. In particular, $h_A(t)$ is a rational function of $t$. 
\end{thm}


Again let $A$ be a finite dimensional Gorenstein graded ring. Since the Hilbert function is symmetric, $h_A(t)= h_0 + h_1t + h_2t^2+ \cdots + h_st^s$ with $h_i= H_A(i)$ and $h_i= h_{s-i}$. Then 
	\[
	h_A(1/t) = t^{-s} h_A(t).
	\]


\begin{ex}
$A= k[x,y]/(x^2,y^2)= k \oplus \langle x,y \rangle \oplus \langle xy \rangle$. So $s=2$. The bilinear map $A_1 \times A_2 \to A_2$ is a perfect pairing, so $A$ is Gorenstein. $h_A(t)= 1+2t+t^2$, so $h_A(1/t)= 1+2/t+1/t^2= 1/t^2(1+2t+t^2)$. 
\end{ex}


\begin{ex}
$A= k[x,y]/(x^2,xy,y^3)$. $H_A: (1,2,1)$ same Hilbert function as previous example but $A$ is not Gorenstein since $x$ kills all terms in degree 1, $xA_{\geq 1}= 1$ but $x$ does not have degree 2=s. 
\end{ex}



\subsection{Module-Theoretic Properties of Gorenstein Rings}

Observe that for any finite dimensional graded algebra $A$, the $k$-dual $A^\vee= \Hom_k(A,k)$ is an injective $A$-module. This follows directly from $\Hom - \otimes$ adjointness, we want ot show $\Hom_A(-,A^\vee)$ is exact. But $\Hom_A(-,A^\vee)= \Hom_A(-, \Hom_k(A,k))= \Hom_k(-\otimes_A A,k)= \Hom_k(-,k)$, which is exact. 
	\[
	A^\vee = \Hom_k(A,k) = \Hom_k( \oplus_{i=0}^s A_i,k) = \oplus_{i=0}^s \Hom_k(A_i,k) \cong \oplus_{i=0}^s A_{s-i}
	\]
So $A^\vee \cong A$ as vector spaces. One can check that $A^\vee \cong A$ as $A$-modules. The upside is that a Gorenstein finite dimensional algebra is self injective, i.e. injective as a module over itself. The converse is also true: sketch: show $A^\vee= \Hom_k(A,k)$ is the injective hull of $k$, since $A$ is self-injective and contains $k$, conclude $A \cong A^\vee$. 

It follows that if $A$ is Gorenstein, then every finitely generated $A$-module is torsionless and in fact is reflexive. Sketch: Start with $k= A/A_{\geq 1}$. We have $k^*= \Hom_A(k,A)= \ann_A A_{\geq 1}= \soc A \cong k$, where the last isomorphism follows since $A$ is Gorenstein. So $k^{**} \cong k$ also, and we just have to show $k \to k^{**}$ is not zero. Then finish by induction on $\dim_k M$. 



%%%%%%%%%%%%



\begin{dfn}
A graded algebra $A= \oplus_{i=0}^\infty A_i$ with $A_0=k$ a field is called Gorenstein if there is a regular sequence $x_1,\ldots,x_d$, of elements of positive degree so that $\overline{A}:= A/(x_1,\ldots,x_d)$ is a finite dimensional Gorenstein ring. Note $d$ is necessarily $\dim A$. 
\end{dfn}


Equivalently, though we we will not prove this, the quotient $A/(x_1,\ldots,x_d)$ is a finite-dimensional Gorenstein ring for every regular sequence $x_1,\ldots,x_d$. How do Hilbert series behave when we kill a regular sequence? 


\begin{prop}
Let $A$ be a graded ring and $x \in A$ a homogeneous element of degree $e>0$. Then
	\[
	h_A(t)= \dfrac{h_{A/(x)}(t) - t^e h_{\ann x}(t)}{1 - t^e}
	\]
\end{prop}

In particular, $x$ is a nonzero divisor if and only if $h_{A/(x)}(t)= (1-t^e) h_A(t)$.


The ``in particular'' is clear by subsitution, get zero, but that's the sum of dimensions of graded pieces so must be zero ring?


For the rest, consider a more general situation. Let
	\[
	0 \ma{} L \ma{} M \ma{} N \ma{} 0
	\]
be an exact sequence of graded $A$-modules and homogeneous maps of degree zero so $L_i \hookrightarrow M_i$, $M_i \twoheadrightarrow N_i$. Then for each degree $n$, we get
	\[
	0 \ma{} L_n \ma{f_n} M_n \ma{g_n} N_n \ma{} 0
	\]
is an exact sequence of vector spaces. But then we can easily calculate dimensions. Then $\dim_k M_N= \dim_k L_n + \dim_k N_n$. Or in terms of Hilbert functions, $H_M(n)= H_L(n) + H_N(n)$ so that $h_M(t)= h_L(t) + h_N(t)$. 


Now assume that $f$ and $g$ are homogeneous of degrees $a$ and $b$, respectively, i.e. $f(L_n) \subseteq M_{n+a}$, $g(M_N) \subseteq N_{n+b}$. Then for each $n$, we get a short exact sequence 
	\[
	0 \ma{} L_n \ma{f_n} M_{n+a} \ma{g_{n+a}} N_{n+a+b} \ma{} 0
	\]
Then 
	\[
	H_L(n) - H_M(n+a) + H_N(n+a+b) = 0 
	\]
Now
	\[
	\sum_n H_M(n+a)t^n = t^{-a} \sum_n H_M(n+a) t^{n+a} = t^{-a} h_M(t)
	\]
So that
	\[
	h_L(t) - t^{-a} h_M(t) + t^{-a-b} h_N(t) = 0 
	\]
Long exact sequences give similar alternating sums. 


Proof of Prop: We have the exact sequence
	\[
	0 \ma{} \ann(x) \ma{i} A \ma{x} A \ma{\pi} A/(x) \ma{} 0
	\]
where $\deg i=0$, $\deg x= e$, $\deg \pi = 0$. Then we get exact sequences
	\[
	0 \ma{} \ann(x)_n \ma{} A_n \ma{} A_{n+e} \ma{} (A/(x))_{n+e} \ma{} 0
	\]
of vector spaces. By above, we get
	\[
	h_{\ann x}(t) - h_A(t) + t^{-e} h_A(t) - t^{-e} h_{A/(x)}(t) = 0
	\]
Multiplying by $t^e$ and juggling, 
	\[
	(1-t^e) h_A(t) = h_{A/(x)}(t) - t^e h_{\ann x}(t)
	\]
\qed \\




\begin{cor}
Le t$A$ be as above and $x_1,\ldots,x_c$ be homogeneous elements of positive degrees $e_1,\ldots,e_c$. Then we have a coefficient-wise inequality of power series 
	\[
	h_A(t) \preccurlyeq \dfrac{h_{A/(x_1,\ldots,x_e)}(t)}{\prod_{i=1}^c (1-t^{e_i})}
	\]
with equality if and only if $x_1,\ldots,x_c$ is a regular sequence. 
\end{cor}


\begin{ex}
We can compute the Hilbert series for any complete intersection: $A= k[x_1,\ldots,x_n]/(f_1,\ldots,f_c)$, where $\deg x_i = d_i$, $\deg f_i= e_i$, and $f_1,\ldots,f_c$ is a regular sequence. First, let $S= k[x_1,\ldots,x_n]$ with $\deg x_i= e_i$. Then $x_1,\ldots,x_n$ is an $S$-regular sequence with $S/(x_1,\ldots,x_n)= k$. So 
	\[
	h_S(t) = \dfrac{h_k(t)}{\prod_{i=1}^n (1-t^{d_i})}
	\]
Then $h_A(t) = h_{S/(f_1,\ldots,f_c)}= h_S(t) \prod_{j=1}^c (1-t^{e_j})= \dfrac{\prod_{j=1}^c (1-t^{e_j})}{\prod_{i=1}^n (1-t^{d_i})}$. 
\end{ex}


\begin{prop}
Let $A$ be a Gorenstein graded ring of Krull dimension $d$. Then $h_A(1/t)= (-1)^d t^a h_A(t)$ for some integer $a$. 
\end{prop}

\pf Let $x_1,\ldots, x_d$ be a regular sequence so that $\overline{A}= A/(x_1,\ldots,x_d)= \overline{A}_0 \oplus \cdots \oplus \overline{A}_s$ is a finite dimensional Gorenstein algebra. Let $e_i = \deg x_i$. Then we know 

\begin{enumerate}[(i)]
\item $h_A(t) = \dfrac{h_{\overline{A}}(t)}{\prod_{i=1}^d (1-t^{e_i})}$
\item $h_{\overline{A}}(1/t) = t^{-s} h_{\overline{A}}(t)$
\end{enumerate}

So $h_A(1/t)= \dfrac{h_{\ov{A}}(1/t)}{\prod_{i=1}^d (1- (1/t)^{e_i})}= \dfrac{t^{-s} h_{\ov{A}}(t)}{t^{-e_1-e_2-\cdots-e_d} \prod_{i=1}^d (t^{e_i}-1)}= (-1)^d t^{s+e_1+\cdots+e_d} h_A(t)$ \qed \\


\begin{rem}
We know that the formula $h_A(1/t) = (-1)^d t^a h_A(t)$ follows from the Gorenstein property, but is not equivalent (even when $d=0$). Stanley proved that the two are equivalent when $A$ is a CM domain. We will not prove this. 
\end{rem}


Back to invariant theory. So $S= k[x_1,\ldots,x_n]$, $G \subseteq \GL_n(k)$ finite with $|G| \in k^\times$ and $R= S^G$. We will assume $k$ is algebraically closed.

\begin{dfn}
The Hilbert series of $R$ is called the Molien series of $G$.
	\[
	M_G(t) = h_R(t)
	\]
\end{dfn}

We will compute $M_G(t)$ in terms of $G$. More generally, the Molien series of a linear character $\chi: G \to k^\times$ is the Hilbert series of the semi-invariants
	\[
	R_\chi = S_\chi^G= \{ f \in S \colon gf= \chi(g)f \}
	\]
These are graded subsets of $S$. 
	\[
	M_\chi(t) = \sum_{i \in \Z} \dim_k(R_\chi)_i t^i
	\]
If $\chi$ is trivial, then $M_{\text{triv}}(t) = N_G(t)$. 

\begin{rem}
One can also do this for isotypic components but we will not. 
\end{rem}


So we want to compute $\dim_k(R_\chi)_i$. Recall that we have the fancy Reynold's operators $\rho_\chi: S \to S$ given by $f \mapsto \dfrac{1}{|G|} \sum_{g \in G} \chi(g)^{-1} gf$ with image $R_\chi$, and $(\rho_\chi)^2= \rho_\chi$. These properties preserve degrees, so we get linear maps $(\rho_\chi)_i: S_i \to S_i$ with image $(R_\chi)_i$. We can choose bases for $S_i$ so that $(\rho_\chi)_i$ is in rank normal form: $\two{I}{0}{0}{0}$. Then $\dim_k(R_\chi)_i = \dim_k(\im(\rho_\chi)_i)= \text{trace}((\rho_\chi)_i)$. PLug in the formula for $\rho_\chi$: $\dim(R_\chi)_i= \dfrac{1}{|G|} \sum_{g \in G} \chi(g)^{-1} \text{trace}(g|_{S_i})$.


\begin{thm}[Molien]
	\[
	M_\chi(t) = \dfrac{1}{|G|} \sum_{g \in G} \dfrac{\chi(g)^{-1}}{\det(I-tg)}
	\]
In particular,
	\[
	M_G(t) = \dfrac{1}{|G|} \sum_{g \in G} \dfrac{1}{\det(I-tg)}
	\]
\end{thm}


\begin{ex}
$R= k[u,v]^{C_2}= k[u^2,uv,v^2] \cong k[x,y,z]/(xz-y^2)$, $C_2= \left\{ \two{1}{0}{0}{1}, \two{-1}{0}{0}{-1} \right\}$. 


Then $M_G(t) = \dfrac{1}{2} \left( \dfrac{1}{\det(I-tI)} + \dfrac{1}{\det(I+tI)}\right)$ which is $\dfrac{1}{2} \left( \dfrac{1}{(1-t)^2} + \dfrac{1}{(1+t)^2} \right)$. which is
	\[
	\dfrac{1+t^2}{(1-t^2)^2}
	\]
which is also the Hilbert series of $k[x,y,z]/(f)$ with $\deg x= \deg y= \deg z=2$, $\deg f= 4$
	\[
	\dfrac{1-t^4}{(1-t^2)^3}= \dfrac{1+t^2}{(1-t^2)^2}
	\]
We had to use those degrees to get a graded isomorphism. 
\end{ex}


We will now focus on the case where $\chi=$ triv, so we want
	\[
	h_R(t) = M_G(t) = \dfrac{1}{|G|} \sum_{g \in G} \dfrac{1}{\det(I-tg)}
	\]
We computed $\dim_k R_i= \dfrac{1}{|G|} \sum \text{tr}(g\big|_{S_i})$. So we know that $M_G(t)= \sum_k \dim_k(R_i) t^i= \dfrac{1}{|G|} \sum_i \sum_{g \in G} \text{tr}(g \big|_{S_i}) t^i$. Then it suffices to show that 
	\[
	\dfrac{1}{\det(I-tg)}= \sum_{i=0}^\infty \text{tr}(g\big|_{S_i}) t^i
	\]
for each $g \in G$. So fix $g \in G$. Since $G$ is finite, $g$ has finite order. The formula is true for all $g \in \GL_n(k)$, but finite order makes the proof simpler. In particular, if $g^r= I$, then the minimal polynomial of $g$ divides $x^r-1$. The roots of $x^r-1$ are distinct since $\char k \nmid |G|$ (note that if $\char k \mid r$, then $\char k \mid G$ since $r \mid G$). Therefore, the eigenvalues of $g$ are distinct. But then $g$ is diagonalizable. We may assume $g= \text{diag}(\lambda_1,\ldots,\lambda_n)$, where $\lambda_i$ are the eigenvalues. In particular, $gx_i = \lambda_i x_i$ for each $x_i \in S= k[x_1,\ldots,x_n]$. The $i$th graded piece $S_i$ has basis
	\[
	\left\{ x_1^{a_1} x_2^{a_2} \cdots x_n^{a_n} \colon a_1 + \cdots + a_n \right\}.
	\]
The action of $g$ on $S_i$ sends that basis vector to $\lambda_1^{a_1} \cdots \lambda_n^{a_n} x_1^{a_1} x_2^{a_2} \cdots x_n^{a_n}$. So the action of $g$ on $S_i$ is also diagonal and
	\[
	\text{tr}(g\big|_{S_i}) = \sum_{a_1+\cdots+a_n= i} \lambda_1^{a_1} \cdots \lambda_n^{a_n}.
	\]
So now we use the geometric series:
	\[
	\begin{split}
	\sum_{i=0}^\infty \text{tr}(g\big|_{S_i}) t^i &= \sum_{i=0}^\infty \sum_{a_1+\cdots+a_n= i } \lambda_1^{a_1} \cdots \lambda_n^{a_n} t^i \\
	&= \sum_{i=0}^\infty \sum_{a_1+\cdots+a_n= i} (\lambda_1^{a_1} t^{a_1})(\lambda_2^{a_2} t^{a_2}) \cdots (\lambda_n^{a_n} t^{a_n}) \\
	&= \sum_{i=0}^\infty \sum_{a_1+\cdots+a_n= i} (\lambda_1t)^{a_1} (\lambda_2 t)^{a_2} \cdots (\lambda_n t)^{a_n} \\
	&= \dfrac{1}{1-\lambda_1t} \, \dfrac{1}{1-\lambda_2t} \, \cdots \, \dfrac{1}{1-\lambda_nt} \\
	&= \dfrac{1}{\prod_{j=1}^n (1-\lambda_jt)} 
	\end{split}
	\]
Now 
	\[
	\prod_{j=1}^n (1- \lambda_jt)= \dfrac{\prod_{j=1}^n \lambda_j^{-1}}{\prod_{j=1}^n (\lambda_j^{-1} -t)}= \dfrac{\det(g^{-1})}{\deg(g^{-1}-tI)} \cdot \dfrac{\det g}{\det g}= \dfrac{1}{\det(I-tg)}
	\]
\qed \\


%\begin{ex}
%$G= C_3$, generated by $\two{\omega}{0}{0}{\omega^2}$, where $\omega$ is a primitive cube root of 1. So $R= k[u,v]^{C_3} = k[ u^3,uv,v^3] \cong k[x,y,z]/ (xz-y^3)$. By the equation $\sum_{g \in G} \text{tr}(g \big|_{S_i}) t^i$, 
%	\[
%	M_G(t)= \dfrac{1}{3} \left( \dfrac{1}{\det(I-tI)} + \dfrac{1}{\det\left(I - \two{t\omega}{0}{t\omega^2}} + \dfrac{1}{\det\left(I - \two{t\omega^2}{t\omega}\right)} \irhgt)= \dfrac{1}{3} \left( \dfrac{1}{(1-t)^2} + \dfrac{2}{(1-t\omega)(1-t^2\omega)}}= \dfrac{1-t+t^2}{(1-t)(1-t^3)}. 
%	\]
%\end{ex}


\begin{ex} Using Molien's formula to compute invariants
Let 
	\[
	G= \left\{ \two{\pm 1}{}{\pm 1}, \two{\pm i}{0}{\mp i}, \two{0}{\pm i}{\pm i}{}, \two{}{\pm 1}{}{\pm1} \right\} = Q_8
	\]
What is $k[u,v]^G$? Molien's fomula says
	\[
	h_R(t) = \dfrac{1}{8} \left( \dfrac{1}{(1-t)^2} + \dfrac{1}{(1+t)^2} + \dfrac{6}{1+t^3} \right)= \dfrac{1+t^6}{(1-t^4)^2}= 1 + 2 t^4 + t^6 + \cdots
	\]
So $R$ contains 2 linearly independent polynomials of degree 4 and 6. After a brief such, $u^2v^2$ and $u^4+v^4$ are invariant. Since they're invariant, so is their Jacobian so that $u^5v - uv^5 \in R_6$. Set $X= u^4+v^4$, $Y= u^2v^2$, and $Z= u^5-uv^5$. These must then live inside: so $k[X,Y,Z] \subseteq R = k[u,v]^G$. Any 3 polynomials in $k[u,v]$ have some defining relation so can cretae that $Z^2 = X^2Y-4Y^3$. So $A= k[X,Y,Z] \cong k[y,z,]/(z^2-x^2y+4y^3)$. Then $h_A(t)= \dfrac{1-t^{1/2}}{(1-t^4)^2(1-t^6)} = \dfrac{1}{t^6}{(1-t^4)^2} = h_R(t)$. But then $A=R$. Finally when $S^G$ is gorenstein, recall a pseudo-reflection is an $n \times n$ matrix of finite order having 1 as an eigenvalue of multiplicity $n-1$.
	\[
	g= \begin{pmatrix}
	1 & 1 & \cdots \\
	& 1 & \\
	& \ddots &  \\
	& & \lambda
	\end{pmatrix}, \quad \lambda^r=1.
	\]
\end{ex}





\begin{thm}[Stanley, Watanabe]
Let $G \subseteq \GL_n(k)$ be a finite subgroup with $|G| \in k^\times$. Then $R= k[x_1,\ldots,x_n]^G$ is gorenstein if and only if
	\[
	\sum_{g \in G} \dfrac{1}{\det(I-tg)}= t^{-m} \sum_{g \in G} \dfrac{\det g}{\det(I-tg)}
	\]
where $m$ is the number of pseudo-relections in $G$. In particular, when $G$ is small (i.e. $m=0$), then $R$ is Gorenstein if and only if $G \subseteq \SL_n(k)$.
\end{thm}

\pf We will use fact that since $R$ is a domain, $R$ is gorenstein if and only if
	\[
	h_A(1/t) = (-1)^d t^a h_A(t)
	\]
for some $a \in \Z$. Plug in our formula for $h_R(t)= M_G(t)$
	\[
	\dfrac{1}{|G|} \sum_{g \in G} \dfrac{1}{\det(I-tg)} = h_R(t) = (-1)^d t^{-a} h_R(1/t)= \dfrac{1}{|G|} (-1)^d t^{-a} \sum_{g \in G} \dfrac{1}{\det(I-t^{-1}g)} \cdot \dfrac{t \deg(g)^{-1}}{t (\det g)^{-1}}  = \dfrac{1}{|G|} (-1)^d t^{-a+n} \sum_{g \in G} \dfrac{\det g}{\det(I-tg)}
	\]

Now
	\[
	\sum_{g \in G} \dfrac{1}{\det(I-t^{-1}g)}= (-1)^n \sum_{g \in G} \dfrac{1}{\det(t^{-1}g-I)} = (-1) \sum_{g \in G} \dfrac{\deg(g)^{-1}}{\det(t^{-1}I-g^{-1})}= (-1) \sum_{g \in G} \dfrac{\det g}{\det(t^{-1}I-g)} = (-1) t^n \sum_{g \in G} \dfrac{\det g}{\det(I-tg)}
	\]
So
	\[
	\sum_{g \in G} \dfrac{1}{\det(I-tg)} = t^{-a+n} \sum_{g \in G} \dfrac{\det g}{\det(I-tg)}
	\]
up to sign. So we need to just identify $m= a-n$ as the number of pseudo-reflections. Expanding both sides of the above as Laurent series in $1-t$. Recall that a Laurent series $\dfrac{c_r}{(1-t)^r} + \dfrac{c_{r-1}}{(1-t)^{r-1}} + \cdots$ with $c_r \neq 0$ has a pole of order $r$ at $t=1$. We know each term $\dfrac{1}{\det(I-tg)}$ is equal to 
	\[
	\dfrac{1}{\prod_{j=1}^n (\lambda_j-t)}
	\]
since $g$ is diagonalizable and $k= \overline{k}$. We need to know the multiplicity of 1 as an eigenvalue---that will be the order of the pole at $t=1$. The biggest the multiplicity can be is $n$, when $g= I$, if and only if $g=I$. The next biggest is $n-1$ if and only if $g$ is a pseudo-reflection. So 
	\[
	\sum_{g \in G} \dfrac{1}{\det(I-tg)}= \dfrac{1}{(1-t)^n} + \sum_{g \text{ps ref}} \dfrac{1}{(1-t)^{n-1} (\det g - t)} + \text{h.o.t.}= \dfrac{1}{(1-t)^n} + \dfrac{1}{(1-t)^{n-1}} \sum_{g \text{ps}} \dfrac{1}{\det g - t} + \text{h.o.t.}
	\]
To get this in terms of only $(1-t)$, we need
	\[
	\dfrac{1}{(1-t)^{n-1}} \sum_{g \text{ps}} \dfrac{1}{\det g-t}= \dfrac{c_{n-1}}{(1-t)^{n-1}} + \dfrac{c_{n-2}}{(1-t)^{n-2}} + \cdots 
	\]
To solve for $c_{n-1}$, multiply by $(1-t)^{n-1}$ and plug in $t=1$.
	\[
	\sum_{g \text{psd}} \dfrac{1}{\det g-1}= c_{n-1}
	\]
and that is equal to $\sum_{g \text{psd}} \dfrac{1}{1-\det g}$. On the left hand side, we have 
	\[
	\dfrac{1}{(1-t)^n} + \dfrac{1}{(1-t)^{n-1}} + \sum_{g \text{psd}} \dfrac{1}{1-\det g} + \text{h.o.t.}
	\]
The right hand side is, using $t^{-m}= \left(\dfrac{1}{t}\right)^m = \left(\dfrac{1}{1-(1-t)} \right)^m = \left( \sum_{i=0}^\infty (1-t)^i \right)^m= (1+(1-t)+(1-t)^2+\cdots)^m= 1+ m(1-t) + \cdots$
	\[
	t^{-m} \sum_{g \in G} \dfrac{\det g}{\det(I-tg)} = (1+m(t-1)+\cdots) \cdot (\dfrac{1}{(1-t)^n} + \dfrac{1}{(1-t)^{n-1}} \sum_{g \text{psd}} \dfrac{\det g}{1-\det g} + \cdots)
	\]
The coefficient of $\dfrac{1}{(1-t)^{n-1}}$ in this product is $m+ \sum_{g \text{psd}} \dfrac{\det g}{1-\det g}$. Now we are done by comparing coefficients we obtain that 
	\[
	\sum_{g \text{psd}} \dfrac{1}{1-\det g} = m + \sum_{g \text{psd}} \dfrac{\det g}{1-\det g}
	\]
Moving over left sum, obtain
	\[
	\sum_{g \text{psd}} 1= m 
	\]
so that $m$ is the number of pseudo-reflections. \qed \\


For the last sentence, we just need to show that $\sum_{g \in G} 1 = \sum_{g \in G} \det g$ if and only if $\det g=1$ for all $g$. If $\det g=1$, then simple. For the other direction, recall $\det g$ is a root of unity. So then must be all 1 since add to 1. 




%%%%%%%%%%%%%%%%%%%%%%%


\begin{cor}[Watanabe]
If $G \subseteq \SL_n$, then $R$ is Gorenstein. Furthermore, if $G$ is small, then the converse holds.
\end{cor}

\pf If $G \subseteq \SL_n$, then $\det g=1$ for all $g \in G$. There are no pseudo-reflections in $\SL$. In particular, there are no pseudo-reflections in $G$. The last part was done above (all parts of $G$ are roots of unity). \qed \\


% End of a long chapter

When is $R= k[W]^G$ an isolated singularity? Postpone this until ramification theory. (Answer: when no $g \in G \setminus \{1\}$ has 1 for an eigenvalue, which is stronger than no pseudo-reflections.)


Recall our goal is to understand the direct summands of $S= k[W]$ as an $R$-module (they are all MCM modules) and the structure of

1) the maps between them
2) the relationship with the rest of the $R$-modules.

Main tool: the skew group algebra (twisted group ring, smash product, \dots)

Let $S$ be a commutative ring (lose nothing by pretending $S= k[W]$) and $G$ be a group acting on $S$ by automorphisms. The skew group algebra $S\#G$ is an $S$-module, free on the elements of $G$, so the elements of $S\#G$ are formal sums $\sum_{g \in G} s_g \cdot g$, where $s_g \in S$ for all $g \in G$. The action is $(s \cdot g)(t\cdot h)= sg(t)gh$ for $s,t \in S$ and $g,h \in G$. So moving $g$ past $t$ twisted the ring element. Why? Patience. What are the $S\#G$ modules?


Notice $S$ sits inside $S\#G$ as $\{s \cdot 1_G\}$ as a subring. So $S\#G$ is an $S$-algebra. In particular, any $S\#G$-module $M$ is an $S$-module by restriction of scalar. On the other hand, $G$ also sits inside $S\#G$ as $\{1_s \cdot g\}$. So $M$ comes with a $G$-action $g(x)= (1_s \cdot g)x$, $x \in M$, $g \in G$. So $S\#G$-module is an $S$-module with an action of $G$. That action is compatible with the $S$-module structure: 
	\[
	\begin{split}
	g(sx)&= g((s1)x) \\
	&= (1g)(s1)x \\
	&= (g(s)g)x \\
	&=(g(s)1)(1g)x \\
	&= g(s)g(x)
	\end{split}
	\]
Conversely, an $S$-module $M$ with an action of $G$ that satisfies $g(sx)=g(s)g(x)$ is an $S\#G$-module.

\begin{rem}
This allows us to talk about the invariants of an $S\#G$-module, namely $M^G:= \{ x \in M \colon gx=x \}$. Also notice that $S$ itself is an $S$-module with a compatible $G$-action. So we can consider $S^G$.
\end{rem}

Similarly, an $S\#G$-homomorphism between $S\#G$-modules $M,N$ is an $S$-module homomorphism that respects the group action. So $f: M \to N$ is $S\#G$-linear if and only if it is $S$-linear and $f(g(x))=g(f(x))$ for all $x \in M$, $g \in G$. 


We can define an $S\#G$-module structure on $\Hom_S(M,N)$: given $f: M \to N$ and $g \in G$, $(gf)(x)= g(f(g^{-1}(x)))$. It is routine to check that the action is compatible with the $S$-module structure. 


What is $\Hom_S(M,N)^G$? Well, $f$ is invariant if and only if $gf=f$ for all $g$ if and only if $(gf)(x)= f(x)$ for all $g$ if and only if $g(f(g^{-1}(x)))= f(x)$ for all $g$ if and only if $f(g^{-1}(x))= g^{-1}(f(x))$ for all $g$. So an $S$-linear map is invariant if and only if it is $S\#G$-linear. Another way of saying this is $\Hom_S(M,N)^G= \Hom_{S\#G}(M,N)$ (an actual equality). 


Fact: If $|G|$ is invertible in $S$, then taking $G$-invariants is an exact functor, i.e. if $0 \ma{} L \ma{\alpha} M \ma{\beta} N \ma{} 0$ is an exact sequence of $S\#G$-modules, then
	\[
	0 \ma{} L^G \ma{\text{res }\alpha} M^G \ma{\text{res }\beta} N^G \ma{} 0
	\]
is an exact sequence. 

Check: The restriction of an injective is clearly injective. Clearly the composition of the restrictions is also 0. We will only check surjectivity. Take $y \in N^G \subseteq N$. Then there is $x \in M$ with $\beta(x)=y$. Notice for any $g \in G$, $\beta(gx)=g(\beta x)=g(y)=y$. So 
	\[
	\beta \left(\dfrac{1}{|G|} \sum_{g \in G} g(x) \right)= y
	\]
and the sum is in $M^G$. The same trick works for exactness in the middle. 


Consequently, $\Ext_{S\#G}^i(M,N)= \Ext_S^i(M,N)^G$. 

\begin{cor}
An $S\#G$-module is projective if and only if it is projective over $S$. 
\end{cor}

\pf We know $P$ is projective over a ring $T$ if and only if $\Ext_T^i(P,-)=0$ for $i>0$. Then $_{S\#G}M$ is projective if and only if $\Ext_{S\#G}^i(M,-)=0$ for $i>0$ if and only if $\Ext_S^i(M,-)^G=0$. We know $\Ext_S^i(M,-)=0$ if and only if $_SM$ is projective. It remains to show that $\Ext_S^i(M,-)^G=0$ if and only if $\Ext_S^i(M,-)=0$. 

It is clear that if $\Ext_S^i(M,-)=0$ then $\Ext_S^i(M,-)^G=0$. Now if $M$ is projective, i.e. $\Ext_S^i(M,-)=0$, it is a direct summand of $(S\#G)^n$ for some $n$. But $S\#G$ is free as an $S$-module, so $M$ is also projective over $S$. \qed \\


\begin{cor}
If $S= k[x_1,\ldots,x_n]$, then $S\#G$ has global dimension $n$, i.e. $n= \max\{ \text{proj dim}_{S\#G} M \colon M \text{ f.g. over } S\#G\}$. 
\end{cor}

\pf Recall $\text{proj dim}_{S\#G} M= \max\{ i \colon \Ext_{S\#G}^i(M,-) \neq 0 \}$. But this is $\max \{ i \colon \Ext_S^i(M,-)^G \neq 0 \}$. But this is at most $\max \{ i \colon \Ext_S^i(M,-) \neq 0\}$, which is at most $n$ by Auslander-Buchsbaum-Serre, which says that the global dimension of a polynomial ring (or any regular ring) is $n$. So $\text{g, dim} S\#G \leq n$. To show equality, we must construct an $S\#G$-module of projective dimension $n$. The short version is that the Kozul Complex on $x_1,\ldots,x_n$ is an $S\#G$-linear free resolution of $S/(x_1,\ldots,x_n) \cong k$. 


The longer version: Let $V= (x_1,\ldots,x_n)/(x_1,\ldots,x_n)^2$. This is a $k$-vector space of rank $n$ with basis $x_1,\ldots,x_n$ (really bars). And $K_p:= S \otimes_k \bigwedge^p V$, where $p \geq 0$ and $\bigwedge^p V$ is the $p$th exterior power of $V$. This means it has basis $\{ x_{i_1} \wedge x_{i_2} \wedge \cdots \wedge x_{i_p} \colon i_1<i_2<\cdots<i_p\}$. Then $S \otimes_k \bigwedge^p V$ is the free $S$-module on the same basis. Since $G$ acts on $S$ linearly, it acts on $V$. It therefore acts on $\bigwedge^p V$ for all $p$. The main thing about $\bigwedge^p V$ is $v \wedge w= -(w \wedge v)$ for all $v,w \in V$. With that, not only is each $\bigwedge^p$ a representation of $G$, the maps $\bigwedge^p V \to \bigwedge^{p+1} V$ given by $\omega \mapsto \omega \wedge (\sum x_i)= \sum (\omega \wedge x_i)$ and the maps are $G$-linear. The exact sequence 
	\[
	0 \ma{} S \otimes \bigwedge^0 V \ma{} S \otimes \bigwedge^1 V \ma{} S \otimes \bigwedge^2 V \ma{} \cdots \ma{} S \otimes \bigwedge^n V \ma{} 0
	\]
is an $S$-linear free resolution of $S/(x_1,\ldots,x_n)$. Note the last two above are congruent to $S^n \to S$ with map $e_i \mapsto \sum x_j$, $j \neq i$. Furthermore, each free module and each map (differential) is $G$-linear. So this is a free resolution of $k$ over $S\#G$. This can not be a shorter one since we know that $\text{proj dim}_S k= n$. So $\text{gl dim} S\#G= n$. \qed \\


So in the case where $S= k[W]$, the ring $S\#G$ encodes all $S$-modules with $G$-action, and has global dimension $n= \dim W$ (like $S$). 

The ``twist'' in the algebra structure is cooked up exactly to make a certain map a ring homomorphism. Let $S= k[W]$, $G$ a finite group with $|G| \in k^\times$, and $R= S^G$. Consider the endomorphism ring $\End_R(S)$ of $S$ as an $R$-module. Define
	\[
	\gamma: S\#G \ma{} \End_R(S)
	\]
by considering an $S$-linear combination of endomorphisms of $S$ as an endomorphism of $S$. 
	\[
	\sum s_g \cdot g \mapsto \sum s_g g.
	\]
Note: each $g \in G$, considered as an endomorphism of $S$, is $R$-linear
	\[
	g(rs)= g(r) g(s) = rg(s)
	\]
for $r \in R$, $s \in S$. Finally, $\gamma$ is a ring homomorphism. Moreover, $\gamma$ is not generally injective or surjective.


\begin{thm}[Auslander, 62]
If $G$ is small, then $\gamma$ is an isomorphism.
\end{thm}


To prove this, we will need Ramification Theory, i.e. unramified and \'etale maps. 



\subsection{Ramification Theory}

Recall a ring homomorphism $A \to B$, where $A,B$ are commutative noetherian rings, is of \emph{finite type} if $B$ is a finitely generated $A$-algebra, i.e. $B \cong A[x_1,\ldots,x_r]/I$ for some ideal $I$. The morphism is \emph{essentially of finite type} if $B$ is a localization of an $A$-algebra of finite type, i.e. $B \cong (A[x_1,\ldots,x_r]/I)_S$. 


\begin{dfn}[Ramified]
Let $\phi: (A,\fm,k) \to (B, \fn,l)$ is a local homomorphism ($\phi(\fm) \subseteq \fn$, i.e. no non-unites of $A$ become units in $B$) of local noetherian rings. We say $\phi$ is unramified if
\begin{enumerate}[(i)]
\item it is essentially of finite type
\item $\fm B= \fn$
\item $k \to l$ is a finite separable field extension
\end{enumerate}
If in addition $A \to B$ is flat, $\phi$ is called \'etale. 
\end{dfn}


\begin{rem}
Some people call this ``essentially unramified'' and reserve unramified for maps of finite type. Intuition if $p$ is a prime element in $\Z$ and $\mathcal{O}$ is some finite $\Z$-algebra, the prime $p$ might split, $qr=p$, or ramify, $q^e=p$. 
\end{rem}


\begin{ex}
1) A finite separable field extension is unramified and even \'etale. 

2) Any quotient $A \to A/I$, $I \neq 0$, is unramified (with no residue field growth) but never flat, so not \'etale. 

3) Let $(A,\fm,k)$ be a local ring, $f(x) \in A[x]$ a monic irreducible polynomial, and $q \subseteq A[x]$ a prime ideal containing $\fm$ not containing $f'(x)$. Set $B= (A[x]/(f(x)))_q$. What is $B/\fm B$? Well
	\[
	B \otimes_A A/\fm \cong (k[x]/(f(x)))_{\overline{q}}= k[x]/(f(x))
	\]
and in particular $f'(x) \neq 0$ in this ring (really its image). But then this is a finite separable extension of $k$. In particular, $\fm B$ must be a maximal ideal (following the congruences, get a field), so $\fm B= qB=\fn$ is the unique maximal ideal of $B$. So $B$ is unramified over $A$. This is also \'etale, though we will not show this. This construction is called a pointed \'etale neighborhood of $A$. 
\end{ex}


Facts: 
a) Every unramified local map $A \to B$ is `basically' of this form: every unramified local map $A \to B$ factors as a sequence of pointed \'etale neighborhood followed by a surjection. (``Local Structure Theorem for \'Etale Maps''). 

b) Taking $\varinjlim \{$ pointed \'etale neighborhoods of $A\}$ is ``the'' Henselization of $A$, the smallest $A$-algebra satisfying Hensel's Lemma $A \hookrightarrow A^n \hookrightarrow \widehat{A}$. 


Extended definition: A ring homomorphism $A \to B$ is unramified at a prime ideal $q$ in $\spec B$ if the induced map $A_{q \cap A} \to B_q$ is unramified. It is unramified if it is unramified at every prime ideal. 


\begin{ex}
If $l_1, \ldots, l_t$ are finite separable field extensions of a field $k$, then $k \to l_1 \times \cdots \times l_t$ is unramified (and in fact \'etale). 
\end{ex}


BIG FACT: Every unramified field extension of a field is of this form, products of finite separable extensions. (Serre, 50s?). 


Why is this truly a more general definition? Problem: For this to be consistent with the old definition, we need unramified-ness to localize. To do this, we need to give a different definition which is equivalent and obviously localizes. 


\begin{dfn}[Enveloping Algebra]
Let $A \to B$ be a ring homomorphism. The enveloping algebra is $B \otimes_A B$. 
\end{dfn}


BTW if $A$ and $B$ were noncommutative, what we would use is $B \otimes_A B^{\text{op}}$. There is a natural map $\mu: B \otimes_A B \to B$ given by $b \otimes b' \mapsto bb'$, extending by linearity. This is a surjective ring homomorphism. 


Set $J= \ker \mu$, an ideal of $B \otimes_A B$. Then $B \cong B \otimes_A B/J$. Equivalently, we have a short exact sequence
	\[
	0 \ma{} J \ma{} B \otimes_A B \ma{} B \ma{} 0.
	\]


Remarks: $J$ is generated (as an ideal of $B \otimes_A B$) by elements of the form $b \otimes 1 - 1 \otimes b$. Certainly, $J$ contains those. On the other hand if
	\[
	\mu \left( \sum_i b_i \otimes b_i' \right) = 0,
	\]
then $\sum_i b_i b_i' = 0$. But $\sum_i b_i b_i' = \sum_o (1 \otimes b_i')(b_i \otimes 1 - 1 \otimes b_i)$ is generated by elements of the appropriate `shape.' 


2) Caution: $B \otimes_A B$ has two $B$-module structures on the left and on the right: $b \cdot (b' \otimes b'')= bb' \otimes b''$, $(b' \otimes b'')b= b' \otimes b''b$ and \emph{they do not have to agree}. In particular, $J$ has two distinct $B$-module structures. Luckily, they coincide modulo $J^2$: Claim for any $b,b' \in B$
	\[
	b(b' \otimes 1- 1 \otimes b') - (b' \otimes 1 - 1 \otimes b')b \in J^2.
	\]
This is
	\[
	bb' \otimes 1 - b \otimes b' - b' \otimes b + 1 \otimes b'b= (b \otimes 1-1\otimes b)(b' \otimes 1 - 1 \otimes b') \in J^2
	\]
So $J/J^2$ has an unambiguous $B$-module structure. By the way, this is sometimes called the \emph{module of K\"ahler differentials} of $B/A$, written $\Omega^1_{B/A}$. 


3) If $A \to B$ is essentially of finite type, then $J/J^2$ is a finitely generated $B$-module. Specifically, if $B= (A[x_1,\ldots,x_r]/I)_W$, then $J/J^2$ is generated over $B$ by $\overline{x_i \otimes 1 - 1 \otimes x_i}$, $i=1,\ldots,r$> So $J/J^2$ localizes well: it vanishes if and only if it vanishes locally at every maximal or prime ideal. 


\begin{lem}
Let $A \to B$ be a ring homomorphism, essentially of finite type. TFTA:

i) $B$ is projective as a $B \otimes_A B$-module.
ii) the exact sequence
	\[
	0 \ma{} J \ma{} B \otimes_A B \ma{\mu} B \ma{} 0
	\]
splits as $B \otimes_A B$-modules. 

(iii) $\mu(\ann_{B \otimes_A B} J)= B$. 

iv) $J$ is generated by an idempotent of $B \otimes_A B$: a single element $e$ satisfying $e^2=e$

v) $J/J^2=0$.  
\end{lem}

\pf (i) $\iff$ (ii) is obvious. via the exact sequence. 

(ii) $\iff$ (iii): The map $\mu$ splits if and only if the induced homomorphism 
	\[
	\Hom_{B \otimes_A B}(B,\mu): \Hom_{B \otimes_A B} (B, B \otimes B) \ma{\mu \otimes -} \Hom_{B \otimes_A B}(B,B)
	\]
the identity is in the image, i.e. the map is surjective. We know $B \cong B \otimes_A B/J$ as $B \otimes_A B$-modules, so $\Hom_{B \otimes_A B}(B,X)= \Hom_{B \otimes_A B}(B \otimes_A B/J,X) \cong \{ x \in X \colon Jx=0 \} = \ann_X J$. So in those terms, we want
	\[
	\ann_{B \otimes_A B} J \ma{\mu} \ann_B J
	\]
to be surjective. So $\mu$ splits if and only if $\mu(\ann_{B \otimes_A B} J)= B$. 

Finally, (iv) $\iff$ (v) are true for any finitely generated ideals. 

(ii)  $\iff$ (iv): If $\mu: B \otimes_A B \to B$ splits, there is some $B \otimes_A B$-linear map $j: B \to B \otimes_A B$ with $\mu j= 1_B$. Set $e=j(1)$ (a separability idempotent). Then $e^2=e$ and $e$ generates (Check) $J$ as $B \otimes_A B$-ideal. \qed \\


\begin{prop}
Let $A \to B$ be essentially of finite type. TFAE:

i) the exact sequence 
	\[
	0 \ma{} J \ma{} B \otimes_A B \ma{\mu} B \ma{} 0
	\]
splits as $B \otimes_A B$-modules. 

ii) $A \to B$ is unramified

iii) $A_\fm \to B_\fn$ is unramified for every maximal ideal $\fn \subseteq B$ with $\fm= \fn \cap A$. 
\end{prop}

\pf In the notes. \qed \\





















